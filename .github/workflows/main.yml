name: Build Kernel
on:
  workflow_dispatch:

jobs:
  Build-Kernel:
    strategy:
      fail-fast: false
    runs-on: ubuntu-latest
    permissions:
      contents: read

    steps:
    - name: Download Clang 21
      run: |
        mkdir -p clang-21
        wget https://github.com/llvm/llvm-project/releases/download/llvmorg-21.0.0/clang+llvm-21.0.0-x86_64-linux-gnu.tar.xz
        tar -xf clang+llvm-21.0.0-x86_64-linux-gnu.tar.xz -C clang-21 --strip-components=1
    - name: Build Kernel
      uses: Gabrielx7/kernel_build_action@main
      with:
          kernel-url: https://github.com/ElGabrielx7/Gabrielx7-android_kernel_samsung_sm8250.git
          kernel-dir: interstellar
          kernel-branch: interstellar
          config: not_defconfig
          arch: arm64
          gcc: false
          aosp-clang: false
          other-clang-url: "file://clang-21"
          ksu: true
          kvm: true

    - name: Upload Build Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: kernel-artifacts
        path: anykernel3/*.zip
